# MCV 多视图协调改进总结

## 📋 改进概述

根据MCV（多视图协调）评分标准，将项目从"展示型"改造为"分析型"系统，实现了完整的视图联动和分析功能。

---

## ✅ 已实现的改进

### 1. **全局状态管理（Redux）**

**文件**: `src/store/slices/siteSlice.ts`

新增MCV相关状态：
- `hoveredYear`: 当前鼠标悬停年份（用于联动）
- `selectedCategory`: 事件分类筛选（politics/academic/campus/discipline/all）
- `selectedPeriod`: 历史时期筛选（founding/republic/war/adjustment/reform/all）
- `timeRange`: 时间范围刷选 `[start, end]`
- `sidePanelType`: 侧边面板类型（campus/alumni/null）
- `sidePanelYear`: 侧边面板对应的年份

### 2. **底部时间轴概览（Overview Bar）**

**文件**: `src/components/OverviewBar.tsx`

**功能**:
- 2D折线图显示年份-学生总数关系
- **刷选（Brushing）**: 拖拽选择时间段
- **联动**: 刷选后自动跳转3D视图到对应时间段
- 高亮当前年份位置

**学术依据**: 遵循 Shneiderman 的 mantra: *"Overview first, zoom and filter, then details-on-demand"*

### 3. **侧边面板（Dock Panel）替代Modal**

**文件**: `src/components/SidePanel.tsx`

**改进**:
- ❌ 旧方式：全屏Modal覆盖3D视图
- ✅ 新方式：侧边滑出面板，3D视图缩小但保持可见
- **并列视图**: 3D历史背景 + 2D详细数据图同时可见
- 支持校区风貌和校友图谱两种类型

### 4. **筛选器组件（Filter Bar）**

**文件**: `src/components/FilterBar.tsx`

**功能**:
- **事件分类筛选**: 政治事件/学术突破/校园建设/学科调整
- **历史时期筛选**: 建校初期/民国时期/抗战西迁/院系调整/改革开放
- 实时联动3D视图高亮/虚化

### 5. **视觉编码（Visual Encoding）**

**文件**: `src/components/UniversityHistory.tsx`

#### 颜色编码（Color Encoding）
- 🔴 **红色** (`#ff4444`): 政治事件
- 🔵 **蓝色** (`#4444ff`): 学术突破
- 🟢 **绿色** (`#44ff44`): 校园建设
- 🟠 **橙色** (`#ffaa44`): 学科调整
- 🔷 **默认蓝** (`#00448a`): 其他

#### 大小编码（Size Encoding）
- 根据学生总数计算重要性
- 公式: `scale = 1 + studentCount / 10000` (最大2倍)
- 重要性高的年份节点更大

#### 透明度编码（Opacity Encoding）
- 未通过筛选的事件: `opacity: 0.2` (虚化)
- 通过筛选的事件: `opacity: 1` (正常显示)

### 6. **视图联动（View Coordination）**

#### 6.1 刷选联动
- **时间轴刷选** → **3D视图跳转**: 自动滚动到时间范围开始位置
- **时间轴刷选** → **3D视图高亮**: 只显示选中时间段的事件

#### 6.2 Hover联动
- **3D悬停年份** → **侧边面板高亮**: 如果侧边面板打开，自动高亮对应年份的数据
- **3D悬停年份** → **节点放大**: 悬停时节点放大1.1倍

#### 6.3 筛选联动
- **分类筛选** → **3D视图颜色变化**: 只显示对应分类的事件，其他虚化
- **时期筛选** → **3D视图高亮**: 只显示对应时期的事件

### 7. **分析任务定义**

**核心分析目标**: 探索天津大学百余年校史中，**学科分布**如何随**校区变迁**和**历史时期**产生动态关联。

**分析场景示例**:
1. 用户选择"抗战西迁"时期
2. 3D视图只显示1937-1945年的事件（其他虚化）
3. 侧边面板显示西迁路线图
4. 用户发现：动荡时期学校地理位置剧烈变动，办学规模收缩

---

## 📁 新增文件清单

```
src/
├── components/
│   ├── OverviewBar.tsx          # 底部时间轴概览
│   ├── OverviewBar.css
│   ├── SidePanel.tsx             # 侧边面板
│   ├── SidePanel.css
│   ├── FilterBar.tsx             # 筛选器
│   └── FilterBar.css
├── store/
│   ├── hooks.ts                  # Redux hooks
│   └── slices/
│       └── siteSlice.ts          # 扩展MCV状态
└── app.tsx                        # Redux Provider配置
```

---

## 🎯 MCV评分点对应

### 评分点1: 多视图联动 ✅
- ✅ 底部时间轴（Overview）控制3D视图（Detail）
- ✅ 筛选器同时驱动多个视图
- ✅ Hover联动：3D悬停 → 侧边面板高亮
- ✅ 并列视图：3D + 2D数据图同时可见

### 评分点2: 分析任务 ✅
- ✅ 明确的分析目标：学科分布与校区变迁/历史时期的关系
- ✅ 支持多维度筛选（分类、时期、时间范围）
- ✅ 提供分析场景演示

### 评分点3: 视觉编码 ✅
- ✅ 颜色编码：事件类型 → 颜色
- ✅ 大小编码：重要性 → 节点大小
- ✅ 透明度编码：筛选状态 → 透明度
- ✅ 图例说明（FilterBar中的分类按钮）

### 评分点4: 交互设计 ✅
- ✅ 刷选（Brushing）: 时间轴拖拽选择
- ✅ 联动（Linking）: 多视图同步更新
- ✅ 筛选（Filtering）: 分类和时期筛选
- ✅ 概览+细节（Overview+Detail）: 底部时间轴 + 3D主视图

---

## 🚀 使用指南

### 基本操作

1. **查看概览**: 底部时间轴显示整体趋势
2. **刷选时间段**: 在时间轴上拖拽选择时间段，3D视图自动跳转
3. **筛选事件**: 顶部筛选器选择分类或时期
4. **查看详情**: 点击左右浮岛打开侧边面板
5. **联动分析**: 悬停3D节点，观察侧边面板高亮

### 分析流程示例

**场景：分析1952年院系调整的影响**

1. 选择筛选器 → "学科调整"
2. 在时间轴上刷选 → 1949-1952年
3. 3D视图自动跳转并高亮该时期
4. 点击右侧浮岛 → 查看校友网络变化
5. 观察：学科外流、校友分布变化

---

## 📊 技术实现细节

### Redux状态流

```
用户操作（刷选/筛选/Hover）
    ↓
Redux Action (setTimeRange/setSelectedCategory/setHoveredYear)
    ↓
Redux Store 更新
    ↓
多个组件订阅状态变化
    ↓
视图同步更新（3D视图/侧边面板/时间轴）
```

### 性能优化

- 虚拟滚动：只渲染可见区域的年份模块
- 节流：滚轮事件使用 `requestAnimationFrame` 节流
- 缓存：使用 `useMemo` 缓存筛选结果

---

## 🔮 未来扩展建议

1. **更丰富的联动**:
   - 侧边面板点击校友节点 → 3D视图高亮对应年份
   - 学科词云点击 → 3D视图高亮相关事件

2. **更多分析视图**:
   - 学科演变时间线
   - 1952年院系调整流程图（Sankey图）
   - 地理信息地图视图

3. **数据导出**:
   - 导出当前筛选结果
   - 导出分析报告

---

## 📝 提交报告建议

### 系统介绍

> 本系统是一个**多视图协调（MCV）**的历史数据可视化分析平台，旨在探索天津大学百余年校史中，学科分布如何随校区变迁和历史时期产生动态关联。

### 多视图联动设计

1. **主视图（Context）**: 3D线性时间轴，提供宏观历史背景
2. **概览视图（Overview）**: 底部2D时间轴，支持刷选时间段
3. **细节视图（Details）**: 侧边数据面板，显示校区风貌和校友网络
4. **交互（Coordination）**: 通过刷选、筛选、Hover实现多视图同步

### 分析过程演示

> 用户通过筛选"1952年院系调整"，发现3D道路上该年份节点变大（重要性编码），同时右侧流向图显示大量学科外流，直观揭示了那一时期天大"在此分家"的历史特征。

---

**完成时间**: 2024-01  
**改进版本**: v2.0 (MCV增强版)
